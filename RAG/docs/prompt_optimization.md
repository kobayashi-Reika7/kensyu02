# 精度向上: プロンプト最適化

## 効果的なプロンプトのガイドライン

| ガイドライン | 説明 |
|--------------|------|
| 文脈に含まれる事実のみ使用 | 検索された文書内の情報に限定して回答 |
| 推測や想像を避ける | 不確かな場合は「分からない」と正直に回答 |
| 簡潔で明確な日本語 | 冗長な表現を避け、要点を簡潔に伝える |
| 根拠を示す | 回答の出典となる文書を明示する |
| 役割を明確にする | LLMにアシスタントやエキスパートとしての役割を与える |
| 構造化された回答形式 | 整理された形式で回答するよう指示 |

## プロンプトテンプレート

### 基本的なプロンプト

```python
template = """あなたは専門的なアシスタントです。以下の文脈のみを使用して、質問に正確に答えてください。

文脈:
{context}

質問: {question}

回答:"""
```

### 明示的な指示を含むプロンプト（推奨）

```python
template = """あなたは日本語の質問応答システムです。以下の文脈から質問に答えてください。

【文脈】
{context}

【質問】
{question}

【回答の際の注意点】
・文脈に書かれている事実のみを使用する
・推測や一般知識を混ぜない
・答えられない場合は正直にその旨を伝える
・丁寧で分かりやすい日本語で回答する

【回答】
"""
```

## 実装方法

```python
from langchain_core.prompts import PromptTemplate

prompt = PromptTemplate(
    template=template,
    input_variables=["context", "question"]
)

qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type="stuff",
    retriever=vectorstore.as_retriever(),
    chain_type_kwargs={"prompt": prompt}
)
```

## ドメイン別のカスタマイズ

温泉ガイド向けなど、ドメインに応じて「根拠の明示」「回答形式」を追加する例：

```python
template = """
この情報の内容に基づいて質問に答えてください。
推測や記載のない情報は答えないでください。

【参考情報】
{context}

【質問】
{question}

【厳守事項】
・参考情報に含まれない事実や一般知識を使用しない
・推測や想像は行わない
・参考情報から判断できない場合は「参考情報からは分かりません」と回答する
・回答は簡潔で分かりやすい日本語にする

【回答形式】
・結論を最初に述べる
・必要に応じて箇条書きを使用
・根拠となる参考情報の要点を明示する

【回答】
"""
```
