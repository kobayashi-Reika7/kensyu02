<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>電卓アプリ</title>
  <style>
    /* 電卓全体のレイアウト */
    body {
      font-family: 'Segoe UI', 'Meiryo', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(160deg, #2c3e50 0%, #3498db 100%);
      color: #2c3e50;
    }

    /* 電卓本体のコンテナ */
    .calculator {
      background: #ecf0f1;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    /* タイトル */
    h1 {
      text-align: center;
      font-size: 1.25rem;
      margin: 0 0 1rem 0;
      color: #2c3e50;
    }

    /* 表示エリア（計算式・結果を表示） */
    .display {
      width: 100%;
      min-height: 3rem;
      padding: 0.75rem 1rem;
      font-size: 1.5rem;
      text-align: right;
      background: #fff;
      border: 2px solid #bdc3c7;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
      font-variant-numeric: tabular-nums;
    }

    /* ボタンエリア（グリッドレイアウト） */
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }

    /* 各ボタンの共通スタイル */
    .btn {
      padding: 1rem;
      font-size: 1.25rem;
      font-weight: 600;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: transform 0.1s, background 0.15s;
    }

    /* クリック時の即時フィードバック（レスポンス要件に対応） */
    .btn:active {
      transform: scale(0.96);
    }

    /* 数字ボタン */
    .btn-number {
      background: #fff;
      color: #2c3e50;
      border: 2px solid #bdc3c7;
    }

    .btn-number:hover {
      background: #e8e8e8;
      border-color: #95a5a6;
    }

    /* 演算子ボタン */
    .btn-operator {
      background: #3498db;
      color: #fff;
    }

    .btn-operator:hover {
      background: #2980b9;
    }

    /* 実行ボタン（=） */
    .btn-equals {
      background: #27ae60;
      color: #fff;
    }

    .btn-equals:hover {
      background: #229954;
    }

    /* クリアボタン */
    .btn-clear {
      background: #e74c3c;
      color: #fff;
    }

    .btn-clear:hover {
      background: #c0392b;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <h1>電卓アプリ</h1>
    <div class="display" id="display">0</div>
    <div class="buttons">
      <button class="btn btn-number" data-value="7">7</button>
      <button class="btn btn-number" data-value="8">8</button>
      <button class="btn btn-number" data-value="9">9</button>
      <button class="btn btn-operator" data-value="/">÷</button>
      <button class="btn btn-number" data-value="4">4</button>
      <button class="btn btn-number" data-value="5">5</button>
      <button class="btn btn-number" data-value="6">6</button>
      <button class="btn btn-operator" data-value="*">×</button>
      <button class="btn btn-number" data-value="1">1</button>
      <button class="btn btn-number" data-value="2">2</button>
      <button class="btn btn-number" data-value="3">3</button>
      <button class="btn btn-operator" data-value="-">−</button>
      <button class="btn btn-number" data-value="0">0</button>
      <button class="btn btn-clear" data-value="C">C</button>
      <button class="btn btn-equals" data-value="=">=</button>
      <button class="btn btn-operator" data-value="+">+</button>
    </div>
  </div>

  <script>
    /**
     * 電卓アプリのメインロジック
     * 要件: 四則演算、クリア、数値入力、表示、実行
     * データは変数のみで保持（ページ内の一時データ）
     */

    // 表示用のDOM要素
    const displayElement = document.getElementById('display');

    // 現在の入力値（ユーザーが入力中の数値）
    let currentValue = '0';

    // 前の値（演算子の左側の数値）
    let previousValue = null;

    // 選択中の演算子（+, -, *, /）
    let currentOperator = null;

    // 「=」押下後の計算式表示（例: "12 + 34 = 46"）
    let lastFullExpression = null;

    // 内部の演算子記号を表示用（×、÷）に変換する
    function operatorToDisplay(op) {
      var map = { '+': '+', '-': '−', '*': '×', '/': '÷' };
      return map[op] || op;
    }

    // 表示エリアを更新する（演算子・=を含む計算式を表示）
    function updateDisplay() {
      var text;
      if (lastFullExpression !== null) {
        text = lastFullExpression;
      } else if (previousValue !== null && currentOperator !== null) {
        text = previousValue + ' ' + operatorToDisplay(currentOperator) + ' ' + currentValue;
      } else {
        text = currentValue;
      }
      displayElement.textContent = text;
    }

    // 数値を入力する
    function inputNumber(num) {
      lastFullExpression = null;  // 計算式表示をクリアして数値入力に切り替え
      if (currentValue === '0' && num !== '0') {
        currentValue = num;
      } else if (currentValue !== '0') {
        currentValue += num;
      }
      updateDisplay();
    }

    // 演算子を押したときの処理
    function inputOperator(operator) {
      lastFullExpression = null;  // 計算式表示をクリア
      var num = parseFloat(currentValue);

      // 連続で演算子を押した場合は前の計算を先に実行
      if (previousValue !== null && currentOperator !== null) {
        var result = calculate(previousValue, num, currentOperator);
        if (result === 'Error') {
          lastFullExpression = previousValue + ' ' + operatorToDisplay(currentOperator) + ' ' + currentValue + ' = Error';
          currentValue = 'Error';
          previousValue = null;
          currentOperator = null;
          updateDisplay();
          return;
        }
        previousValue = result;  // 結果を次の演算の左辺として保持
        currentValue = String(result);
        updateDisplay();
      } else {
        previousValue = num;
      }

      currentOperator = operator;
      currentValue = '0'; // 次の数値入力に備えてリセット
    }

    // 四則演算を実行する
    function calculate(a, b, operator) {
      switch (operator) {
        case '+': return a + b;
        case '-': return a - b;
        case '*': return a * b;
        case '/': return b === 0 ? 'Error' : a / b;
        default: return b;
      }
    }

    // 「=」で計算を実行する
    function executeEquals() {
      if (previousValue === null || currentOperator === null) {
        return;
      }

      var num = parseFloat(currentValue);
      var result = calculate(previousValue, num, currentOperator);

      // 計算式を表示用に保存（例: "12 + 34 = 46"）
      var resultStr = result === 'Error' ? 'Error' : String(
        Number.isInteger(result) ? result : Math.round(result * 1000000) / 1000000
      );
      lastFullExpression = previousValue + ' ' + operatorToDisplay(currentOperator) + ' ' + currentValue + ' = ' + resultStr;

      currentValue = resultStr;
      previousValue = null;
      currentOperator = null;
      updateDisplay();
    }

    // クリアする（表示と状態をリセット）
    function clearAll() {
      currentValue = '0';
      previousValue = null;
      currentOperator = null;
      lastFullExpression = null;
      updateDisplay();
    }

    // ボタンクリック時の処理を振り分ける
    function handleButtonClick(value) {
      if (value >= '0' && value <= '9') {
        inputNumber(value);
      } else if (value === 'C') {
        clearAll();
      } else if (value === '=') {
        executeEquals();
      } else if (['+', '-', '*', '/'].includes(value)) {
        inputOperator(value);
      }
    }

    // 各ボタンにクリックイベントを紐づける
    document.querySelectorAll('.btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        handleButtonClick(btn.dataset.value);
      });
    });

    // 初期表示
    updateDisplay();
  </script>
</body>
</html>
